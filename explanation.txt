הסבר על הקוד: מערכת סיווג ז'אנרים מוזיקליים
הקוד שהוצג מיישם מערכת לסיווג ז'אנרים מוזיקליים באמצעות אפליקציית ווב של Streamlit. מטרת המערכת היא לאמן מודל למידת מכונה שיכול לחזות את הז'אנר של קובץ שמע (MP3/WAV) שמועלה אליה.

📝 פירוט הפונקציות
extract_features(file_path, duration=30) (חילוץ מאפיינים)
זוהי פונקציית הליבה האנליטית של המערכת:

מה היא עושה: היא מקבלת נתיב לקובץ אודיו, טוענת אותו באמצעות ספריית Librosa, ומחשבת מערך של 59 מאפיינים מספריים המתארים את המאפיינים האקוסטיים של הצליל.

המאפיינים שמופקים:

MFCCs (Mel-Frequency Cepstral Coefficients): ממוצע וסטיית תקן עבור 13 מקדמים (סה"כ 26 ערכים).

מאפייני Chroma: ממוצע וסטיית תקן עבור 12 מחלקות גובה צליל (Pitch Class) (סה"כ 24 ערכים).

מאפיינים ספקטרליים: מרכז ספקטרלי (Centroid), גלילה ספקטרלית (Rolloff) ורוחב פס ספקטרלי (Bandwidth).

קצב חציית אפס (ZCR): ממוצע וסטיית תקן (קשור לרעש או לקטעים קצביים).

קצב (Tempo): מהירות המוזיקה ב-BPM.

תפקידה: המאפיינים האלה הם התשומות (Inputs) שהמודל משתמש בהן כדי ללמוד ולסווג ז'אנרים.

train_model(data_folder) (אימון המודל)
פונקציה זו מבצעת את כל תהליך אימון מודל למידת המכונה:

איסוף נתונים: סורקת את התיקיות המשויכות לז'אנרים בנתיב data_folder וקוראת ל-extract_features עבור כל שיר.

קידוד תוויות (Label Encoding): ממירה את שמות הז'אנרים (מחרוזות, לדוגמה 'רוק') למספרים (לדוגמה 0, 1) כדי שאלגוריתם למידת המכונה יוכל לעבד אותם.

פיצול נתונים: מחלקת את מערך המאפיינים לקבוצות אימון (80%) ובדיקה (20%).

אימון: מאמנת מודל Random Forest Classifier על נתוני האימון.

הערכה: בודקת את ביצועי המודל על נתוני הבדיקה (שלא נראו במהלך האימון) ומחשבת ציון דיוק ודוח סיווג מפורט.

שמירה: שומרת את המודל המאומן ואת מקודד התוויות לקבצים (.pkl) כדי לאפשר שימוש חוזר בחיזוי מבלי לאמן מחדש.

predict_genre(file_path, model, label_encoder) (חיזוי ז'אנר)
פונקציה זו מבצעת את פעולת הסיווג בפועל על קובץ חדש:

חילוץ: קוראת ל-extract_features כדי להפיק מאפיינים מהקובץ החדש.

חיזוי: משתמשת במודל הטעון כדי לחזות את הז'אנר הסביר ביותר.

הסתברויות: מחשבת את ההסתברות (Confidence) של המודל עבור כל ז'אנר אפשרי (לדוגמה: רוק 65%, ג'אז 20%, פופ 15%).

פענוח: משתמשת במקודד התוויות כדי להמיר את החיזוי המספרי בחזרה לשם הז'אנר (לדוגמה: 1 
→
 'ג'אז').

main() (ממשק המשתמש)
הפונקציה הראשית שמפעילה את ממשק ה-Streamlit:

הצגת UI: מציבה כותרות, טקסט הסבר, ואת רכיבי ה-UI.

ניהול מודל: בסרגל הצד (Sidebar), היא מאפשרת למשתמש לבצע אימון חדש אם אין מודל קיים או לעקוב אחרי מצב המודל.

טעינת קובץ: מאפשרת למשתמש להעלות קובץ אודיו (MP3/WAV).

עיבוד ופלט: אם הועלה קובץ והמודל קיים, היא שומרת את הקובץ באופן זמני, טוענת את המודל, מפעילה את predict_genre, ומציגה את תוצאת החיזוי ואת כל ציוני הביטחון בצורה ויזואלית (כמו פסי התקדמות).

📚 הרחבה: Librosa ו-MFCCs
מהי Librosa?
Librosa היא ספריית פייתון פופולרית שתוכננה במיוחד עבור ניתוח אודיו ומוזיקה (Music Information Retrieval - MIR). היא מספקת פונקציות מוכנות לשימוש להמרת צליל גולמי (Raw Audio) לפורמטים הניתנים לעיבוד עבור למידת מכונה.

בשימוש בקוד: Librosa מאפשרת לטעון קובץ (MP3) לתוך סדרת זמן מספרית (audio) ואת קצב הדגימה שלה (sr), וכן לחשב בקלות מאפיינים מורכבים כמו MFCCs, Chroma, ו-Tempo.

מהם MFCCs (Mel-Frequency Cepstral Coefficients)?
MFCCs הם מאפיינים נפוצים מאוד המייצגים את גוון הצליל (Timbre), כלומר, את האיכות המבדילה בין שני צלילים באותו גובה ובאותה עוצמה (לדוגמה, הבדל בין צליל גיטרה לצליל פסנתר).

העקרון: MFCCs מחקים את האופן שבו האוזן האנושית תופסת צליל. האוזן רגישה יותר לשינויים בתדרים נמוכים מאשר בגבוהים.

תהליך החישוב (פשטני):

הצליל מנותח באמצעות טרנספורם פורייה כדי לקבל את ספקטרום התדרים.

התדרים ממופים לסולם Mel (סולם לוגריתמי שמחקה את התפיסה האנושית).

התוצאה מקוצרת ומוצגת כמספר קטן של מקדמים (13 במקרה זה), אשר מקפלים את המידע האקוסטית החשוב.

מדוע ממוצע וסטיית תקן: מאחר ש-MFCCs מחושבים עבור חלונות זמן קצרים לאורך השיר, אנו מקבלים סדרת זמנים גדולה של מקדמים. אנו מסכמים אותה על ידי לקיחת הממוצע (כדי לתאר את גוון הצליל האופייני) וסטיית התקן (כדי לתאר את מידת השונות של גוון הצליל) לאורך כל 30 שניות השיר.




למה עבור חלונות זמן קצרים מקבלים סדרת זמנים גדולה של מקדמים?


אנו מקבלים סדרת זמנים גדולה של מקדמים (כמו MFCCs) עבור חלונות זמן קצרים מכיוון שאות האודיו המקורי משתנה במהירות לאורך זמן.

להלן ההסבר המפורט:

📏 הסיבה לריבוי מקדמים
אי-נייחות האות (Non-Stationarity):

אות דיבור או מוזיקה אינו "נייח" (Stationary). כלומר, המאפיינים הסטטיסטיים שלו (כמו התדרים הדומיננטיים) משתנים מרגע לרגע.

אם נחשב את ה-MFCCs על שיר שלם (למשל 3 דקות), נקבל רק וקטור אחד של 13 מקדמים. וקטור זה ייתן ממוצע גס, אך יאבד את כל המידע על השינויים הקצביים וההרמוניים המתרחשים במהלך השיר.

שימוש בחלונות קצרים (Short-Time Analysis):

כדי לנתח אות שאינו נייח, אנו משתמשים בניתוח זמן-קצר (Short-Time Fourier Transform - STFT).

האות מחולק למקטעים קצרים מאוד, בדרך כלל באורך 20 עד 40 מילישניות (ms). בטווח זמן קצר זה, ניתן להניח שהאות כמעט נייח, כלומר, תכונותיו הקוליות יציבות יחסית.

עבור כל חלון זמן (כל 20-40ms), מחושבים המאפיינים (כגון 13 מקדמי MFCCs).

היווצרות סדרת הזמנים:

מאחר שיש חפיפה (Overlap) בין החלונות (בדרך כלל 50% או יותר) ואנו מחשבים סט של 13 מקדמים עבור כל חלון המתקדם לאורך השיר, נוצרת סדרת זמנים גדולה.

דוגמה מספרית: שיר באורך 30 שניות (30,000ms), עם חלון של 25ms וקצב התקדמות (Hop Size) של 10ms.

נקבל בערך 
10
30,000
​
 =3000
 חלונות.

עבור כל חלון מקבלים 13 מקדמים.

סה"כ מקדמים: 
3000×13=39,000
 ערכים.

סדרת זמנים זו מתארת כיצד מאפייני גוון הצליל משתנים במהלך השיר.

💡 הסיכום בקוד
הספרייה Librosa מחשבת את ה-MFCCs ומחזירה מערך דו-ממדי:

ציר ראשון: 13 המקדמים (העומק).

ציר שני: מספר חלונות הזמן (הרוחב).

בפונקציה extract_features, אנו "דוחסים" את המידע הרב הזה לשוב וקטור אחד וקבוע בגודלו על ידי חישוב הממוצע (Average) והסטיית תקן (Standard Deviation) של כל אחד מ-13 המקדמים על פני כל ציר הזמן. זהו תהליך של אגרגציה שמאפשר למודל לקבל וקטור מאפיינים יחיד לכל שיר.

מה המקדמים מייצגים

13 המקדמים?


13 מקדמי ה-MFCCs (Mel-Frequency Cepstral Coefficients) מייצגים את מעטפת הספקטרום (Spectral Envelope) של הצליל, כפי שהיא נתפסת על ידי האוזן האנושית. בפשטות, הם מתארים את גוון הצליל (Timbre), המבדיל בין כלים או קולות שונים.

👂 מה מייצג כל מקדם?
כל אחד מ-13 המקדמים אינו מייצג תדר ספציפי, אלא רכיב בתוך הפילטר שעוזר לשחזר את צורת הספקטרום של האות, כשהיא מופשטת מרכיבי המיקרו-שינוי (כגון גובה הצליל הבסיסי).

המקדמים פועלים כך:

מקדם 0 (MFCC 0): מייצג את האנרגיה (Energy) או עוצמת הקול הממוצעת של חלון הזמן הנתון. במקרים רבים, מקדם זה מושמט מניתוח סיווג, או מוחלף בערך האנרגיה המדויק יותר.

מקדמים 1–13: מייצגים את השינויים והמורכבות של מעטפת הספקטרום כשהיא ממופה לסולם ה-Mel הלוגריתמי.

מקדמים נמוכים (1, 2, 3): תורמים בעיקר לתיאור הצורה הכללית והחלקה של המעטפת.

מקדמים גבוהים (4–13): מתארים את הפרטים הדקים יותר במעטפת הספקטרלית, הקשורים למאפייני הצליל הייחודיים של הכלי או הקול.

🎯 תפקיד ה-MFCCs בסיווג ז'אנרים
עבור מודל למידת המכונה, 13 המקדמים הללו מספקים את המידע החיוני הבא:

המאפיין הנמדד	המשמעות לז'אנר
גוון צליל קבוע (Timbre)	האם המוזיקה נשלטת על ידי כלי נשיפה (כמו בג'אז), גיטרות חשמליות עם דיסטורשן (כמו ברוק), או סינתיסייזרים (כמו בדיסקו).
מאפייני ייצור הקול	הדרך שבה כלי הנגינה או הקול משתמשים בתדרים (לדוגמה, צליל "עשיר" של כינור לעומת צליל "פשוט" של חליל).
צפיפות ספקטרלית	האופן שבו האנרגיה מחולקת בין התדרים.

Export to Sheets
בקיצור: 13 המקדמים האלה יוצרים "טביעת אצבע" מספרית קומפקטית המאפשרת למודל להבחין בין צליל "סקסופון" לבין צליל "גיטרה חשמלית", שהם מפתח לזיהוי ז'אנר.

מה המקדמים מייצגים

13 המקדמים?


13 מקדמי ה-MFCCs (Mel-Frequency Cepstral Coefficients) מייצגים את מעטפת הספקטרום (Spectral Envelope) של הצליל, כפי שהיא נתפסת על ידי האוזן האנושית. בפשטות, הם מתארים את גוון הצליל (Timbre), המבדיל בין כלים או קולות שונים.

👂 מה מייצג כל מקדם?
כל אחד מ-13 המקדמים אינו מייצג תדר ספציפי, אלא רכיב בתוך הפילטר שעוזר לשחזר את צורת הספקטרום של האות, כשהיא מופשטת מרכיבי המיקרו-שינוי (כגון גובה הצליל הבסיסי).

המקדמים פועלים כך:

מקדם 0 (MFCC 0): מייצג את האנרגיה (Energy) או עוצמת הקול הממוצעת של חלון הזמן הנתון. במקרים רבים, מקדם זה מושמט מניתוח סיווג, או מוחלף בערך האנרגיה המדויק יותר.

מקדמים 1–13: מייצגים את השינויים והמורכבות של מעטפת הספקטרום כשהיא ממופה לסולם ה-Mel הלוגריתמי.

מקדמים נמוכים (1, 2, 3): תורמים בעיקר לתיאור הצורה הכללית והחלקה של המעטפת.

מקדמים גבוהים (4–13): מתארים את הפרטים הדקים יותר במעטפת הספקטרלית, הקשורים למאפייני הצליל הייחודיים של הכלי או הקול.

🎯 תפקיד ה-MFCCs בסיווג ז'אנרים
עבור מודל למידת המכונה, 13 המקדמים הללו מספקים את המידע החיוני הבא:

המאפיין הנמדד	המשמעות לז'אנר
גוון צליל קבוע (Timbre)	האם המוזיקה נשלטת על ידי כלי נשיפה (כמו בג'אז), גיטרות חשמליות עם דיסטורשן (כמו ברוק), או סינתיסייזרים (כמו בדיסקו).
מאפייני ייצור הקול	הדרך שבה כלי הנגינה או הקול משתמשים בתדרים (לדוגמה, צליל "עשיר" של כינור לעומת צליל "פשוט" של חליל).
צפיפות ספקטרלית	האופן שבו האנרגיה מחולקת בין התדרים.

בקיצור: 13 המקדמים האלה יוצרים "טביעת אצבע" מספרית קומפקטית המאפשרת למודל להבחין בין צליל "סקסופון" לבין צליל "גיטרה חשמלית", שהם מפתח לזיהוי ז'אנר.




